!function(){function t(p,i){return"undefined"==typeof this||Object.getPrototypeOf(this)!==t.prototype?new t(p,i):(e=$(window),o=$(document),n=$("body"),s=$("html, body"),this.options=i=$.extend(!0,{openedClass:"opened",openedBodyClass:"popup-opened",closeBtnSelector:".popup__close",targetPopupId:p.data("popup-target"),eventsNameSpace:"popup",closeOnBgClick:!0,closeOnEsc:!0,closeOnResize:!1,openOnClick:!0,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,remote:p.data("popup-remote")},i),this.$button=p,this.$popup=$('[data-popup-id="'+i.targetPopupId+'"]'),this.defaultEvents="click."+i.eventsNameSpace+" tap."+i.eventsNameSpace,this.remoteData=i.remote?$.extend(!0,i.remote,{url:i.remote.url||p.data("popup-remote")}):i.remote,void this.activate())}var e,o,n,s,p=!1,i=!1;t.prototype.checkAndCloseAllPopups=function(){var t=n.find("[data-popup-id]"),e=t.filter("."+this.options.openedClass);if(e.length){var o=e.data("popup");this.prevPopupScrollTop=o.scrollTop,o.close(!0)}return this},t.prototype.checkAndRunCallback=function(t){return"function"==typeof t?t.call(null,this):void 0!=t&&console.warn("Callback should be a function."),this},t.prototype.open=function(t){return t&&(this.actionsWithRemoteData(t),this.registerCloseBtnClick()),this.checkAndRunCallback(this.options.beforeOpen),this.scrollTop=this.prevPopupScrollTop||e.scrollTop(),this.$popup.data("popupScrollTop",this.scrollTop),n.css("top",-this.scrollTop).addClass(this.options.openedBodyClass),this.$popup.addClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterOpen),this},t.prototype.close=function(t){return this.checkAndRunCallback(this.options.beforeClose),t||(n.removeAttr("style").removeClass(this.options.openedBodyClass),s.scrollTop(this.$popup.data("popupScrollTop")),this.prevScrollTop?this.prevScrollTop=!1:null),this.$popup.removeClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterClose),this},t.prototype.actionsWithRemoteData=function(t){if(t.replaces instanceof Array)for(var e=0,o=t.replaces.length;o>e;e++)$(t.replaces[e].what).replaceWith(t.replaces[e].data);if(t.append instanceof Array)for(e=0,o=t.append.length;o>e;e++)$(t.append[e].what).append(t.append[e].data);if(t.content instanceof Array)for(e=0,o=t.content.length;o>e;e++)$(t.content[e].what).html(t.content[e].data);t.js&&n.append(t.js),t.refresh&&window.location.reload(!0),t.redirect&&(window.location.href=t.redirect)},t.prototype.registerOpenOnClick=function(){var t=this;return this.$button.unbind(this.defaultEvents).on(this.defaultEvents,function(){if(t.checkAndCloseAllPopups(),t.remoteData){var e=t.remoteData;return $.ajax({cache:"false",method:"get",dataType:"json",url:e.url,data:e.data,beforeSend:e.onBeforeSend,complete:e.onComplete,success:t.open.bind(t),error:e.onError}),this}t.open(!1)}),this},t.prototype.registerCloseOnResize=function(){var o=this,s="resize."+this.options.eventsNameSpace;return p||(e.on(s,function(){n.hasClass(o.options.openedBodyClass)&&t.closeAllPopups(o.options.openedClass)}),p=!0),this},t.prototype.registerCloseOnEsc=function(){var e=this,s="keyup."+this.options.eventsNameSpace;return i||(o.on(s,function(o){27==o.keyCode&&n.hasClass(e.options.openedBodyClass)&&t.closeAllPopups(e.options.openedClass)}),i=!0),this},t.prototype.registerCloseOnBgClick=function(){var t=this;return t.$popup.on(this.defaultEvents,function(e){e.target===t.$popup.get(0)&&t.close()}),this},t.prototype.registerCloseBtnClick=function(){var t=this,e=t.$popup.find(this.options.closeBtnSelector);return e.unbind&&e.on?(e.unbind(this.defaultEvents).on(this.defaultEvents,function(){t.close()}),this):(console.warn("Close button was not found"),this)},t.prototype.activate=function(){return this.$popup.data("popup")?(this.$popup.data("popup",this),this.options.openOnClick&&this.registerOpenOnClick(),this):(this.registerCloseBtnClick(),this.$popup.data("popup",this),this.options.closeOnEsc&&this.registerCloseOnEsc(),this.options.closeOnBgClick&&this.registerCloseOnBgClick(),this.options.closeOnResize&&this.registerCloseOnResize(),this.options.openOnClick&&this.registerOpenOnClick(),this)},t.prototype.kill=function(){this.$button.unbind(this.defaultEvents),this.$popup.data("popup",null)},t.kill=function(t){var e=$(t).data("popup");e.kill()},t.closeAllPopups=function(t){t=t||"opened";var e=n.find("[data-popup-id]"),o=e.filter("."+t);if(o.length){var s=o.data("popup");s.close.call(s,!1)}};var l=t.expose=function(e){$=e,$.fn.popup=function(e){return this.each(function(){var o=$(this);new t(o,e)})}};"object"==typeof module&&"object"==typeof module.exports?module.exports=t:"function"==typeof define&&define.amd?define("vintage-popup",function(){return t}):window.Popup=t,l($)}();