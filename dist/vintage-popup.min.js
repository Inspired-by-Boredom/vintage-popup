!function(){function t(p,i){return void 0===this||Object.getPrototypeOf(this)!==t.prototype?new t(p,i):(o=$(window),e=$(document),n=$("body"),s=$("html, body"),this.options=i=$.extend(!0,{openedClass:"opened",openedBodyClass:"popup-opened",closeBtnSelector:".popup__close",targetPopupId:p.data("popup-target"),eventsNameSpace:"popup",closeOnBgClick:!0,closeOnEsc:!0,closeOnResize:!1,openOnClick:!0,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,remote:{url:p.data("popup-remote")}},i),this.$button=p,this.$popup=$('[data-popup-id="'+i.targetPopupId+'"]'),this.defaultEvents="click."+i.eventsNameSpace+" tap."+i.eventsNameSpace,this.activate(),this)}var o,e,n,s,p=!1,i=!1;t.prototype.checkAndCloseAllPopups=function(){var t=n.find("[data-popup-id]"),o=t.filter("."+this.options.openedClass);if(o.length){var e=o.data("popup");this.prevPopupScrollTop=e.scrollTop,e.close(!0)}return this},t.prototype.checkAndRunCallback=function(t){return"function"==typeof t?t.call(null,this):void 0!=t&&console.warn("Callback should be a function."),this},t.prototype.open=function(t){return t&&(this.actionsWithRemoteData(t),this.registerCloseBtnClick()),this.checkAndRunCallback(this.options.beforeOpen),this.scrollTop=this.prevPopupScrollTop||o.scrollTop(),this.$popup.data("popupScrollTop",this.scrollTop),n.css("top",-this.scrollTop).addClass(this.options.openedBodyClass),this.$popup.addClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterOpen),this},t.prototype.close=function(t){return this.checkAndRunCallback(this.options.beforeClose),t||(n.css({top:""}).removeClass(this.options.openedBodyClass),s.scrollTop(this.$popup.data("popupScrollTop")),this.prevScrollTop&&(this.prevScrollTop=!1)),this.$popup.removeClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterClose),this},t.prototype.actionsWithRemoteData=function(t){if(t.replaces instanceof Array)for(var o=0,e=t.replaces.length;o<e;o++)$(t.replaces[o].what).replaceWith(t.replaces[o].data);if(t.append instanceof Array)for(o=0,e=t.append.length;o<e;o++)$(t.append[o].what).append(t.append[o].data);if(t.content instanceof Array)for(o=0,e=t.content.length;o<e;o++)$(t.content[o].what).html(t.content[o].data);t.js&&n.append(t.js),t.refresh&&window.location.reload(!0),t.redirect&&(window.location.href=t.redirect)},t.prototype.registerOpenOnClick=function(){var t=this;return this.$button.unbind(this.defaultEvents).on(this.defaultEvents,function(){if(t.checkAndCloseAllPopups(),t.options.remote.url){var o=t.options.remote;return $.ajax({url:o.url,method:"get",cache:"false",dataType:"json",data:o.data,beforeSend:o.onBeforeSend,success:function(o){t.open(o)},complete:o.onComplete,error:o.onError}),this}t.open(!1)}),this},t.prototype.registerCloseOnResize=function(){var e=this,s="resize."+this.options.eventsNameSpace;return p||(o.on(s,function(){n.hasClass(e.options.openedBodyClass)&&t.closeAllPopups(e.options.openedClass)}),p=!0),this},t.prototype.registerCloseOnEsc=function(){var o=this,s="keyup."+this.options.eventsNameSpace;return i||(e.on(s,function(e){27==e.keyCode&&n.hasClass(o.options.openedBodyClass)&&t.closeAllPopups(o.options.openedClass)}),i=!0),this},t.prototype.registerCloseOnBgClick=function(){var t=this;return t.$popup.on(this.defaultEvents,function(o){o.target===t.$popup.get(0)&&t.close()}),this},t.prototype.registerCloseBtnClick=function(){var t=this,o=t.$popup.find(this.options.closeBtnSelector);return o.unbind&&o.on?(o.unbind(this.defaultEvents).on(this.defaultEvents,function(){t.close()}),this):(console.warn("Close button was not found"),this)},t.prototype.activate=function(){return this.$popup.data("popup")?(this.$popup.data("popup",this),this.options.openOnClick&&this.registerOpenOnClick(),this):(this.registerCloseBtnClick(),this.$popup.data("popup",this),this.options.closeOnEsc&&this.registerCloseOnEsc(),this.options.closeOnBgClick&&this.registerCloseOnBgClick(),this.options.closeOnResize&&this.registerCloseOnResize(),this.options.openOnClick&&this.registerOpenOnClick(),this)},t.prototype.kill=function(){this.$button.unbind(this.defaultEvents),this.$popup.data("popup",null)},t.kill=function(t){$(t).data("popup").kill()},t.closeAllPopups=function(t){t=t||"opened";var o=n.find("[data-popup-id]"),e=o.filter("."+t);if(e.length){var s=e.data("popup");s.close.call(s,!1)}};var l=t.expose=function(o){$=o,$.fn.popup=function(o){var e=[];return this.each(function(){var n=$(this);e.push(new t(n,o))}),1===e.length?e[0]:e}};"object"==typeof module&&"object"==typeof module.exports?module.exports=t:"function"==typeof define&&define.amd?define("vintage-popup",function(){return t}):window.Popup=t,l($)}();