!function(){function e(t,o){return"undefined"==typeof this||Object.getPrototypeOf(this)!==e.prototype?new e(t,o):(o=o||{},this.options={openedClass:o.openedClass||"opened",openedBodyClass:o.openedBodyClass||"popup-opened",closeBtnSelector:o.closeBtnSelector||".popup__close",targetPopupId:o.targetPopupId||t.data("popup-target"),eventsNameSpace:o.eventsNameSpace||"popup",closeOnBgClick:r(o.closeOnBgClick,!0),bodyFixedOnDesktop:r(o.bodyFixedOnDesktop,!0),closeOnEsc:r(o.closeOnEsc,!0),closeOnResize:r(o.closeOnResize,!1),openOnClick:r(o.openOnClick,!0),beforeOpen:o.beforeOpen,afterOpen:o.afterOpen,beforeClose:o.beforeClose,afterClose:o.afterClose,remote:o.remote||t.data("popup-remote")},this.$button=t,this.$popup=$('[data-popup-id="'+this.options.targetPopupId+'"]'),this.defaultEvents="click."+this.options.eventsNameSpace+" tap."+this.options.eventsNameSpace,this.remoteData=this.options.remote?$.extend(!0,this.options.remote,{url:this.options.remote.url||t.data("popup-remote")}):this.options.remote,void this.activate())}var t=$(window),o=$(document),n=$("body"),s=$("html, body"),p=!1,i=!1,a=function(){return window.matchMedia("(max-width: 1199px)").matches},r=function(e,t){return"boolean"==typeof e?e:t};e.prototype.checkAndCloseAllPopups=function(){var e=n.find("[data-popup-id]"),t=e.filter("."+this.options.openedClass);if(t.length){var o=t.data("popup");this.prevPopupScrollTop=o.scrollTop,o.close(!0)}return this},e.prototype.checkAndRunCallback=function(e){return"function"==typeof e?e.call(null,this):void 0!=e&&console.warn("Callback should be a function."),this},e.prototype.open=function(e){return e&&(this.actionsWithRemoteData(e),this.registerCloseBtnClick()),this.checkAndRunCallback(this.options.beforeOpen),(this.options.bodyFixedOnDesktop||a())&&(this.scrollTop=this.prevPopupScrollTop||t.scrollTop(),this.$popup.data("popupScrollTop",this.scrollTop),n.css("top",-this.scrollTop).addClass(this.options.openedBodyClass)),this.$popup.addClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterOpen),this},e.prototype.close=function(e){return this.checkAndRunCallback(this.options.beforeClose),e||(n.removeAttr("style").removeClass(this.options.openedBodyClass),s.scrollTop(this.$popup.data("popupScrollTop")),this.prevScrollTop?this.prevScrollTop=!1:null),this.$popup.removeClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterClose),this},e.prototype.actionsWithRemoteData=function(e){if(e.replaces instanceof Array)for(var t=0,o=e.replaces.length;o>t;t++)$(e.replaces[t].what).replaceWith(e.replaces[t].data);if(e.append instanceof Array)for(t=0,o=e.append.length;o>t;t++)$(e.append[t].what).append(e.append[t].data);if(e.content instanceof Array)for(t=0,o=e.content.length;o>t;t++)$(e.content[t].what).html(e.content[t].data);e.js&&n.append(e.js),e.refresh&&window.location.reload(!0),e.redirect&&(window.location.href=e.redirect)},e.prototype.registerOpenOnClick=function(){var e=this;return this.$button.unbind(this.defaultEvents).on(this.defaultEvents,function(){if(e.checkAndCloseAllPopups(),e.remoteData){var t=e.remoteData;return $.ajax({cache:"false",method:"get",dataType:"json",url:t.url,data:t.data,beforeSend:t.onBeforeSend,complete:t.onComplete,success:e.open.bind(e),error:t.onError}),this}e.open(!1)}),this},e.prototype.registerCloseOnResize=function(){var o=this,s="resize."+this.options.eventsNameSpace;return p||(t.on(s,function(){!a()&&n.hasClass(o.options.openedBodyClass)&&e.closeAllPopups(o.options.openedClass)}),p=!0),this},e.prototype.registerCloseOnEsc=function(){var t=this,s="keyup."+this.options.eventsNameSpace;return i||(o.on(s,function(o){27==o.keyCode&&n.hasClass(t.options.openedBodyClass)&&e.closeAllPopups(t.options.openedClass)}),i=!0),this},e.prototype.registerCloseOnBgClick=function(){var e=this;return e.$popup.on(this.defaultEvents,function(t){t.target===e.$popup.get(0)&&e.close()}),this},e.prototype.registerCloseBtnClick=function(){var e=this,t=e.$popup.find(this.options.closeBtnSelector);return t.unbind&&t.on?(t.unbind(this.defaultEvents).on(this.defaultEvents,function(){e.close()}),this):(console.warn("Close button was not found"),this)},e.prototype.activate=function(){return this.$popup.data("popup")?(this.$popup.data("popup",this),this.options.openOnClick&&this.registerOpenOnClick(),this):(this.registerCloseBtnClick(),this.$popup.data("popup",this),this.options.closeOnEsc&&this.registerCloseOnEsc(),this.options.closeOnBgClick&&this.registerCloseOnBgClick(),this.options.closeOnResize&&this.registerCloseOnResize(),this.options.openOnClick&&this.registerOpenOnClick(),this)},e.prototype.kill=function(){this.$button.unbind(this.defaultEvents),this.$popup.data("popup",null)},e.kill=function(e){var t=$(e).data("popup");t.kill()},e.closeAllPopups=function(e){e=e||"opened";var t=n.find("[data-popup-id]"),o=t.filter("."+e);if(o.length){var s=o.data("popup");s.close.call(s,!1)}},e.initialize=function(e,t){var o="[data-popup-target]";e=e||o;var n="string"==typeof e,s="object"==typeof e,p=e instanceof jQuery||s&&e.selector;return n||p||!s||(t=e,e=o),$(e).popup(t)};var l=e.expose=function(t){$=t,$.fn.popup=function(t){return this.each(function(){var o=$(this);new e(o,t)})}};"object"==typeof module&&"object"==typeof module.exports?module.exports=e:"function"==typeof define&&define.amd?define("vintage-popup",function(){return e}):window.Popup=e,l($)}();