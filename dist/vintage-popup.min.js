!function(){function t(e,o){return"undefined"==typeof this||Object.getPrototypeOf(this)!==t.prototype?new t(e,o):(o=o||{},this.options={openedClass:o.openedClass||"opened",openedBodyClass:o.openedBodyClass||"popup-opened",closeBtnSelector:o.closeBtnSelector||".popup__close",targetPopupId:o.targetPopupId||e.data("popup-target"),eventsNameSpace:o.eventsNameSpace||"popup",closeOnBgClick:r(o.closeOnBgClick,!0),bodyFixedOnDesktop:r(o.bodyFixedOnDesktop,!0),closeOnEsc:r(o.closeOnEsc,!0),closeOnResize:r(o.closeOnResize,!1),openOnClick:r(o.openOnClick,!0),beforeOpen:o.beforeOpen,afterOpen:o.afterOpen,beforeClose:o.beforeClose,afterClose:o.afterClose,remote:o.remote||e.data("popup-remote")},this.$button=e,this.$popup=$('[data-popup-id="'+this.options.targetPopupId+'"]'),this.defaultEvents="click."+this.options.eventsNameSpace+" tap."+this.options.eventsNameSpace,this.remoteData=this.options.remote?$.extend(!0,this.options.remote,{url:this.options.remote.url||e.data("popup-remote")}):this.options.remote,void this.activate())}var e=$(window),o=$(document),n=$("body"),s=$("html, body"),p=!1,i=!1,a=function(){return window.matchMedia("(max-width: 1199px)").matches},r=function(t,e){return"boolean"==typeof t?t:e},l=function(t){e=t(window),o=t(document),n=t("body"),s=t("html, body")};t.prototype.checkAndCloseAllPopups=function(){var t=n.find("[data-popup-id]"),e=t.filter("."+this.options.openedClass);if(e.length){var o=e.data("popup");this.prevPopupScrollTop=o.scrollTop,o.close(!0)}return this},t.prototype.checkAndRunCallback=function(t){return"function"==typeof t?t.call(null,this):void 0!=t&&console.warn("Callback should be a function."),this},t.prototype.open=function(t){return t&&(this.actionsWithRemoteData(t),this.registerCloseBtnClick()),this.checkAndRunCallback(this.options.beforeOpen),(this.options.bodyFixedOnDesktop||a())&&(this.scrollTop=this.prevPopupScrollTop||e.scrollTop(),this.$popup.data("popupScrollTop",this.scrollTop),n.css("top",-this.scrollTop).addClass(this.options.openedBodyClass)),this.$popup.addClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterOpen),this},t.prototype.close=function(t){return this.checkAndRunCallback(this.options.beforeClose),t||(n.removeAttr("style").removeClass(this.options.openedBodyClass),s.scrollTop(this.$popup.data("popupScrollTop")),this.prevScrollTop?this.prevScrollTop=!1:null),this.$popup.removeClass(this.options.openedClass),this.checkAndRunCallback(this.options.afterClose),this},t.prototype.actionsWithRemoteData=function(t){if(t.replaces instanceof Array)for(var e=0,o=t.replaces.length;o>e;e++)$(t.replaces[e].what).replaceWith(t.replaces[e].data);if(t.append instanceof Array)for(e=0,o=t.append.length;o>e;e++)$(t.append[e].what).append(t.append[e].data);if(t.content instanceof Array)for(e=0,o=t.content.length;o>e;e++)$(t.content[e].what).html(t.content[e].data);t.js&&n.append(t.js),t.refresh&&window.location.reload(!0),t.redirect&&(window.location.href=t.redirect)},t.prototype.registerOpenOnClick=function(){var t=this;return this.$button.unbind(this.defaultEvents).on(this.defaultEvents,function(){if(t.checkAndCloseAllPopups(),t.remoteData){var e=t.remoteData;return $.ajax({cache:"false",method:"get",dataType:"json",url:e.url,data:e.data,beforeSend:e.onBeforeSend,complete:e.onComplete,success:t.open.bind(t),error:e.onError}),this}t.open(!1)}),this},t.prototype.registerCloseOnResize=function(){var o=this,s="resize."+this.options.eventsNameSpace;return p||(e.on(s,function(){!a()&&n.hasClass(o.options.openedBodyClass)&&t.closeAllPopups(o.options.openedClass)}),p=!0),this},t.prototype.registerCloseOnEsc=function(){var e=this,s="keyup."+this.options.eventsNameSpace;return i||(o.on(s,function(o){27==o.keyCode&&n.hasClass(e.options.openedBodyClass)&&t.closeAllPopups(e.options.openedClass)}),i=!0),this},t.prototype.registerCloseOnBgClick=function(){var t=this;return t.$popup.on(this.defaultEvents,function(e){e.target===t.$popup.get(0)&&t.close()}),this},t.prototype.registerCloseBtnClick=function(){var t=this,e=t.$popup.find(this.options.closeBtnSelector);return e.unbind&&e.on?(e.unbind(this.defaultEvents).on(this.defaultEvents,function(){t.close()}),this):(console.warn("Close button was not found"),this)},t.prototype.activate=function(){return this.$popup.data("popup")?(this.$popup.data("popup",this),this.options.openOnClick&&this.registerOpenOnClick(),this):(this.registerCloseBtnClick(),this.$popup.data("popup",this),this.options.closeOnEsc&&this.registerCloseOnEsc(),this.options.closeOnBgClick&&this.registerCloseOnBgClick(),this.options.closeOnResize&&this.registerCloseOnResize(),this.options.openOnClick&&this.registerOpenOnClick(),this)},t.prototype.kill=function(){this.$button.unbind(this.defaultEvents),this.$popup.data("popup",null)},t.kill=function(t){var e=$(t).data("popup");e.kill()},t.closeAllPopups=function(t){t=t||"opened";var e=n.find("[data-popup-id]"),o=e.filter("."+t);if(o.length){var s=o.data("popup");s.close.call(s,!1)}},t.initialize=function(t,e){var o="[data-popup-target]";t=t||o;var n="string"==typeof t,s="object"==typeof t,p=t instanceof jQuery||s&&t.selector;return n||p||!s||(e=t,t=o),$(t).popup(e)};var c=t.expose=function(e){$=e,$.fn.popup=function(e){return this.each(function(){var o=$(this);new t(o,e)})},l($)};"object"==typeof module&&"object"==typeof module.exports?module.exports=t:"function"==typeof define&&define.amd?define("vintage-popup",function(){return t}):window.Popup=t,c($)}();